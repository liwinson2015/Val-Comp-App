/* Losers bracket: structured so that:
   - R1 match 1 & R2 match 1 share the same center
   - R3A has 4 single boxes, each centered on one R2 matchup
   - R3B matches are aligned between the 3A singles
   - R4 top and bottom players are aligned to 3B matches
   - LB Final top player centered between the two R4 players (exact math)
*/

.lbViewport{
  --colw: clamp(120px, 9vw, 160px);
  --gap:  clamp(18px, 2.2vw, 26px);

  /* slot + match geometry */
  --slotH: 40px;           /* height of each player box */
  --pairGapInside: 10px;   /* default gap between two players in a match */
  --pairPad: 4px;

  /* total height of one match block (two slots, default gap) */
  --pairH: calc(var(--slotH)*2 + var(--pairGapInside) + var(--pairPad)*2);

  /* base spacing: vertical distance between matches in ROUND 1 */
  --r1Space: 24px;

  --line: #2a2f36;
  --joinW: 2px;
  --stub: 10px;
  --arm:  calc(var(--gap) - var(--stub));

  --slotBg: #f5f7fb;
  --slotBorder: #cfd7ea;
  --textDark: #0f1320;

  --stageW: calc(var(--colw) * 7 + var(--gap) * 6);
  --stageH: clamp(520px, 62vh, 720px);

  --topSpace: 120px;
  --fitW: calc(100vw / var(--stageW));
  --fitH: calc((100vh - var(--topSpace)) / var(--stageH));
  --scale: min(1, var(--fitW), var(--fitH));

  width:100%;
  height:calc(100vh - var(--topSpace));
  display:grid;
  place-items:center;
  overflow:visible;
}

.lbStage{
  width:var(--stageW);
  height:var(--stageH);
  transform:scale(var(--scale));
  transform-origin:top center;
}

.lbGrid{
  width:100%;
  height:100%;
  display:grid;
  grid-template-columns:repeat(7,var(--colw));
  gap:var(--gap);
  align-items:start;
}

/* ---------- rounds / titles ---------- */

.round{
  position:relative;
  width: 100%;           /* fill grid column */
}

/* Force all titles to same height so columns start at same Y */
.roundTitle{
  color:#dfe6f3;
  font-weight:900;
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
  margin-bottom:8px;

  height: 24px;
  line-height: 24px;
  white-space: nowrap;

  text-align:center;     /* center "LB ROUND 1", etc. */
  width:100%;
}

/* container for matches in each column */
.stack{
  position:relative;
  display:grid;
  width: 100%;
}

/* ---------- vertical spacing logic ---------- */

/* R1: base rhythm. each .pair = one matchup */
.r1 .pair{
  margin: calc(var(--r1Space)/2) 0;
}

/* R2: same rhythm and no offset.
   ⇒ R2 match 1 center == R1 match 1 center.
*/
.r2 .pair{
  margin: calc(var(--r1Space)/2) 0;
}
.r2 .stack{
  margin-top: 0;
}

/* R3A (special):
   Four .single blocks, one centered on each R2 matchup.
*/
.r3a .single{
  margin: calc(var(--r1Space)/2) 0;
}
.r3a .stack{
  margin-top: 0;
}

/* R3B:
   Top of match 1 centered between 3A players 1 & 2,
   top of match 2 centered between 3A players 3 & 4.
*/
.r3b .pair{
  margin: calc(var(--pairH) / 2 + var(--r1Space)) 0;
}
.r3b .stack{
  margin-top: calc((var(--slotH) + var(--pairGapInside)) / 2);
}

/* R4:
   Top player aligned with center of 3B match 1,
   bottom player aligned with center of 3B match 2.
   This creates a large vertical separation between them.
*/
.r4 .pair{
  margin: calc(
    var(--pairH) + var(--r1Space) - var(--pairPad) - (var(--slotH) / 2)
  ) 0;
}

.r4 .stack{
  margin-top: calc((var(--slotH) + var(--pairGapInside)) / 2);
}

/* Big custom gap between the two players in R4 */
.r4 .pair .slot + .slot{
  margin-top: calc(
    3 * var(--slotH) +
    2 * var(--pairGapInside) +
    4 * var(--pairPad) +
    2 * var(--r1Space)
  );
}

/* LB Final:
   Exact math so the TOP player of LB Final is centered
   between the TOP and BOTTOM players of LB Round 4.

   Derived:
   margin-top(LB Final stack) =
     3.5*slotH + 2*gap + 3*pad + 2*r1Space
*/
.rFinal .pair{
  margin: 0;
}

.rFinal .stack{
  margin-top: calc(
    3.5 * var(--slotH) +
    2 * var(--pairGapInside) +
    3 * var(--pairPad) +
    2 * var(--r1Space)
  );
}

/* ---------- match boxes + connectors ---------- */

.pair{
  position:relative;
  padding: var(--pairPad) 0;
  width: 100%;           /* match block fills column */
}

/* small horizontal stub on the right connecting to the next column */
.pair::after{
  content:"";
  position:absolute;
  top:50%;
  right: calc(var(--stub) * -1);
  transform: translateY(-50%);
  width: var(--stub);
  height: var(--joinW);
  background: var(--line);
}

/* Single (for R3A) – a match-height container with one centered slot */
.single{
  position: relative;
  height: var(--pairH);   /* same height as a full match */
  display: flex;
  align-items: center;    /* center the slot vertically */
  width: 100%;
}

/* Slot styling (used by both Pair and Single) */
.slot{
  height: var(--slotH);
  border: 2px solid var(--slotBorder);
  border-radius: 0;
  background: var(--slotBg);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 0 10px;
  box-shadow: none;
  text-align: center;

  width: 100%;
  box-sizing: border-box;
}

/* default gap between two slots in a pair (R4 overrides above) */
.slot + .slot{
  margin-top: var(--pairGapInside);
}

.label{
  color: var(--textDark);
  font-weight: 700;
  font-size: 13px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* vertical collectors + arms from previous column
   (R3A singles don't need collectors) */
.r2 .pair,
.r3b .pair,
.r4 .pair,
.rFinal .pair{
  background-image:
    linear-gradient(var(--line), var(--line)),
    linear-gradient(var(--line), var(--line));
  background-repeat: no-repeat, no-repeat;
  background-size:
    var(--joinW) calc(var(--slotH) + var(--pairGapInside)),
    var(--arm) var(--joinW);
  background-position:
    left calc(var(--gap) * -1 + var(--arm)) 50%,
    left calc(var(--gap) * -1)              50%;
}

/* ---------- LB winner pill ---------- */

.lbWinnerCol{
  display:flex;
  flex-direction:column;
  align-items:center;   /* center title + pill horizontally */
  margin-top: 0;        /* keep LB Winner title in the header row */
}

.lbWinnerTitle{
  color:#dfe6f3;
  font-weight:900;
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
  margin-bottom:8px;
  height: 24px;
  line-height: 24px;
  text-align:center;
  width:100%;
}

.lbWinnerPill{
  min-width: var(--colw);
  height: var(--slotH);       /* align pill height to player slots */
  background:#1c2952;
  border:2px solid #122040;
  color:#ffffff;
  border-radius:8px;
  padding:0 16px;
  display:flex;
  align-items:center;
  justify-content:center;

  /* Center of pill is exactly between the two LB Final players.
     Derived:
     margin-top(pill) = 4*slotH + 2.5*gap + 4*pad + 2*r1Space
  */
  margin-top: calc(
    4 * var(--slotH) +
    2.5 * var(--pairGapInside) +
    4 * var(--pairPad) +
    2 * var(--r1Space)
  );
}

.lbWinnerText{
  font-weight:800;
}
